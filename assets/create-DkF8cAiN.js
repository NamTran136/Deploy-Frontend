import{b as A,c as B,r,a as g,A as m,C as P,_ as u,j as a,L as E,B as T}from"./index-BSbp0FSU.js";import{g as q,b as I,r as R,u as D,a as L}from"./firebase-DDMDz6z8.js";const z=()=>{const x=A(),{token:j}=B(e=>e.user),[t,s]=r.useState({id:0,file:void 0,title:"",description:"",author:"",language:"",imageUrl:"",isPrivate:!1,category:"Cổ tích - Thần thoại"}),[f,v]=r.useState([]);r.useEffect(()=>{b()},[]);const b=async()=>{await g.get(m+P).then(e=>e.data).then(e=>{v(e)}).catch(e=>{console.log(e),u.error("Có lỗi xảy ra khi tải")})},y=()=>{x("/admin/books")},N=async e=>{e.preventDefault(),console.log(t);const{status:c}=await g.post(m+T+"/UploadFileAdd",t,{headers:{"Content-Type":"multipart/form-data",Accept:"application/json",Authorization:`Bearer ${j}`}});c===200?(u.success("Add a category successfully."),s({...t,file:void 0,title:"",description:"",author:"",language:"",imageUrl:"",isPrivate:!1,category:"Cổ tích - Thần thoại"}),d(0)):u.error("Có lỗi xảy ra trong quá trình gửi")},n=r.useRef(null),[o,C]=r.useState(void 0),[k,w]=r.useState(!1),[i,d]=r.useState(0);r.useEffect(()=>{o&&U(o)},[o]);const U=async e=>{const c=q(I),F=new Date().getTime()+e.name,S=R(c,F),p=D(S,e);p.on("state_changed",l=>{const h=l.bytesTransferred/l.totalBytes*100;console.log("Update is "+h+"% done"),d(Math.round(h))},l=>{console.log(l.message),w(!0)},()=>{L(p.snapshot.ref).then(l=>s({...t,imageUrl:l}))})};return a.jsx("div",{className:"create-container",onClick:y,children:a.jsxs("div",{className:"create-content",onClick:e=>{e.stopPropagation()},children:[a.jsx("h1",{children:"Add Book"}),a.jsxs("form",{onSubmit:N,children:[a.jsxs("div",{className:"input-wrapper",children:[a.jsx("label",{htmlFor:"file",children:"File Book:"}),a.jsx("input",{type:"file",required:!0,onChange:e=>{e.target.files!==null&&s({...t,file:e.target.files[0]})}})]}),a.jsxs("div",{className:"input-wrapper",children:[a.jsx("label",{htmlFor:"title",children:"Title"}),a.jsx("input",{value:t.title,type:"text",name:"title",required:!0,onChange:e=>s({...t,title:e.target.value})})]}),a.jsxs("div",{className:"input-wrapper",children:[a.jsx("label",{htmlFor:"author",children:"Author"}),a.jsx("input",{value:t.author,type:"text",required:!0,name:"author",onChange:e=>s({...t,author:e.target.value})})]}),a.jsxs("div",{className:"input-wrapper",children:[a.jsx("label",{htmlFor:"language",children:"Language"}),a.jsx("input",{value:t.language,type:"text",required:!0,name:"language",onChange:e=>s({...t,language:e.target.value})})]}),a.jsxs("div",{className:"textarea-wrapper",children:[a.jsx("label",{htmlFor:"description",children:"Description"}),a.jsx("textarea",{value:t.description,rows:4,required:!0,name:"description",onChange:e=>s({...t,description:e.target.value})})]}),a.jsxs("div",{className:"input-wrapper",children:[a.jsx("label",{htmlFor:"imageUrl",children:"Image"}),a.jsx("input",{className:"none",type:"file",ref:n,hidden:!0,required:!0,accept:"image/*",onChange:e=>{e.target.files!==null&&C(e.target.files[0])}}),a.jsx("img",{src:t.imageUrl||"/NoImage.png",alt:"",className:"profile-image",onClick:()=>{var e;n!=null&&((e=n.current)==null||e.click())}}),a.jsx("p",{className:"text-sm self-center",children:k?a.jsx("span",{className:"red",children:"Error uploading image (file size must be less than 2 MB)"}):i>0&&i<100?a.jsx("span",{className:"slate",children:`Uploading: ${i} %`}):i===100?a.jsx("span",{className:"green",children:"Image uploaded successfully"}):""})]}),a.jsxs("div",{className:"switch-wrapper",children:[a.jsx("label",{children:"Status"}),a.jsxs("div",{children:[a.jsx("input",{checked:t.isPrivate,onChange:e=>s({...t,isPrivate:e.target.checked}),type:"checkbox",id:"isPrivate"}),a.jsx("label",{htmlFor:"isPrivate",className:"button"})]})]}),a.jsxs("div",{className:"input-wrapper mt-32",children:[a.jsx("label",{htmlFor:"category",children:"Category"}),a.jsx("select",{id:"category",value:t.category,onChange:e=>s({...t,category:e.target.value}),children:f.map(e=>a.jsx("option",{value:e.name,children:e.name},e.id))})]}),a.jsxs("div",{className:"btn-wrapper",children:[a.jsx("button",{type:"submit",className:"btn-primary",children:"Submit"}),a.jsx(E,{to:"/admin/books",className:"btn-secondary",children:"Back"})]})]})]})})};export{z as default};
