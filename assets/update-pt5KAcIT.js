import{b as L,r as l,n as A,a as d,A as u,B as m,c as T,C as D,j as a,Q as O,L as _,_ as x}from"./index-BSbp0FSU.js";import{g as $,b as z,r as M,u as G,a as K}from"./firebase-DDMDz6z8.js";const Y=()=>{const f=L();l.useEffect(()=>{S(),v()},[]);const{id:j}=A(),[t,r]=l.useState({id:0,file:void 0,title:"",description:"",author:"",language:"",imageUrl:"",isPrivate:!1,category:""}),[b,g]=l.useState(""),v=()=>{d.get(u+m+"/"+j).then(e=>{const s=e.data;r({...t,id:s.id,title:s.title,description:s.description,author:s.author,language:s.language,imageUrl:s.imageUrl,isPrivate:s.isPrivate,category:s.category}),g(s.code)}).catch(e=>{console.log(e)})},{token:y}=T(e=>e.user),k=()=>{f("/admin/books")},N=async e=>{e.preventDefault(),await d.put(`${u}${m}/UploadFileUpdate`,t,{headers:{"Content-Type":"multipart/form-data",Accept:"application/json",Authorization:`Bearer ${y}`}}).then(s=>{s.status===200&&x.success("Edit this book successfully.")}).catch(s=>{console.log(s.message),x.error("Edit this book unsuccessfully.")})},[w,C]=l.useState([]),o=l.useRef(null),[c,U]=l.useState(void 0),[B,E]=l.useState(!1),[i,P]=l.useState(0),S=async()=>{await d.get(u+D).then(e=>e.data).then(e=>{C(e)}).catch(e=>{console.log(e)})};l.useEffect(()=>{c&&F(c)},[c]);const F=async e=>{console.log(e);const s=$(z),R=new Date().getTime()+e.name,I=M(s,R),p=G(I,e);p.on("state_changed",n=>{const h=n.bytesTransferred/n.totalBytes*100;console.log("Update is "+h+"% done"),P(Math.round(h))},n=>{console.log(n.message),E(!0)},()=>{K(p.snapshot.ref).then(n=>r({...t,imageUrl:n}))})};return a.jsx("div",{className:"create-container",onClick:k,children:a.jsxs("div",{className:"create-content",onClick:e=>{e.stopPropagation()},children:[a.jsx("h1",{children:"Edit Book"}),a.jsxs("form",{onSubmit:N,children:[a.jsxs("div",{className:"input-wrapper",children:[a.jsx("label",{htmlFor:"file",children:"File Book:"}),a.jsx("embed",{src:b,type:"application/pdf",width:"100%",height:"400px"}),a.jsx("input",{type:"file",onChange:e=>{if(e.target.files!==null){r({...t,file:e.target.files[0]});const s=URL.createObjectURL(e.target.files[0]);g(s)}}})]}),a.jsxs("div",{className:"input-wrapper",children:[a.jsx("label",{htmlFor:"title",children:"Title"}),a.jsx("input",{value:t.title,type:"text",name:"title",onChange:e=>r({...t,title:e.target.value})})]}),a.jsxs("div",{className:"input-wrapper",children:[a.jsx("label",{htmlFor:"author",children:"Author"}),a.jsx("input",{value:t.author,type:"text",name:"author",onChange:e=>r({...t,author:e.target.value})})]}),a.jsxs("div",{className:"input-wrapper",children:[a.jsx("label",{htmlFor:"language",children:"Language"}),a.jsx("input",{value:t.language,type:"text",name:"language",onChange:e=>r({...t,language:e.target.value})})]}),a.jsxs("div",{className:"textarea-wrapper",children:[a.jsx("label",{htmlFor:"description",children:"Description"}),a.jsx("textarea",{value:t.description,rows:4,name:"description",onChange:e=>r({...t,description:e.target.value})})]}),a.jsxs("div",{className:"input-wrapper",children:[a.jsx("label",{htmlFor:"imageUrl",children:"Image"}),a.jsx("input",{className:"none",type:"file",ref:o,hidden:!0,accept:"image/*",onChange:e=>{e.target.files!==null&&U(e.target.files[0])}}),a.jsx("img",{src:O(t.imageUrl)?t.imageUrl:"/NoImage.png",alt:"",className:"profile-image",onClick:()=>{var e;o!=null&&((e=o.current)==null||e.click())}}),a.jsx("p",{className:"text-sm self-center",children:B?a.jsx("span",{className:"red",children:"Error uploading image (file size must be less than 2 MB)"}):i>0&&i<100?a.jsx("span",{className:"slate",children:`Uploading: ${i} %`}):i===100?a.jsx("span",{className:"green",children:"Image uploaded successfully"}):""})]}),a.jsxs("div",{className:"switch-wrapper",children:[a.jsx("label",{children:"Status"}),a.jsxs("div",{children:[a.jsx("input",{checked:t.isPrivate,onChange:e=>r({...t,isPrivate:e.target.checked}),type:"checkbox",id:"isPrivate"}),a.jsx("label",{htmlFor:"isPrivate",className:"button"})]})]}),a.jsxs("div",{className:"input-wrapper mt-32",children:[a.jsx("label",{htmlFor:"category",children:"Category"}),a.jsx("select",{id:"category",className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",value:t.category,onChange:e=>r({...t,category:e.target.value}),children:w.map(e=>a.jsx("option",{value:e.name,children:e.name},e.id))})]}),a.jsxs("div",{className:"btn-wrapper",children:[a.jsx("button",{type:"submit",className:"btn-primary",children:"Submit"}),a.jsx(_,{to:"/admin/books",className:"btn-secondary",children:"Back"})]})]})]})})};export{Y as default};
