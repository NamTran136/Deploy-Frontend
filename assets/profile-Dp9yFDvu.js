import{u as I,b as R,c as B,r as l,j as a,s as F,d as V,a as U,A as N,U as _,e as b,_ as s,f as z,g as L,h as P,i as d,k as X}from"./index-BSbp0FSU.js";import{g as M,r as O,u as H,a as G,b as J}from"./firebase-DDMDz6z8.js";import{S as K}from"./SubNav-rFK2uXHS.js";function Z(){const t=I(),h=R(),{user:r,loading:k,token:f}=B(e=>e.user),p=l.useRef(null),C={email:r.email,password:"",username:r.username,imageUrl:r.image},[u,x]=l.useState(C),[m,T]=l.useState(void 0),[w,A]=l.useState(!1),[g,v]=l.useState(0);l.useEffect(()=>{m&&D(m)},[m]);const D=async e=>{console.log(e);const i=M(J),n=new Date().getTime()+e.name,c=O(i,n),S=H(c,e);S.on("state_changed",o=>{const j=o.bytesTransferred/o.totalBytes*100;console.log("Update is "+j+"% done"),v(Math.round(j))},o=>{console.log(o.message),A(!0)},()=>{G(S.snapshot.ref).then(o=>x({...u,imageUrl:o}))})},E=async()=>{try{localStorage.clear(),t(F()),h("/")}catch(e){console.log(e)}},y=e=>{x({...u,[e.target.id]:e.target.value})},$=async()=>{try{t(V());const{data:e,status:i}=await U.delete(`${N}${_}/email=${r.email}`,{headers:{Authorization:`Bearer ${f}`}});i!==200?(t(b("Có lỗi xảy ra trong quá trình!")),s.error("Xóa tài khoản thất bại!")):e===!0?(t(z()),s.success("Tài khoản đã được xóa!"),localStorage.clear(),h("/")):s.error("Xóa tài khoản thất bại!")}catch(e){t(b("Có lỗi xảy ra trong quá trình!")),s.error("Xóa tài khoản thất bại!"),console.log("Có lỗi xảy ra: "+e.message)}},q=async e=>{e.preventDefault();try{t(L());const{data:n,status:c}=await U.put(`${N}${P}`,u,{headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${f}`}});if(c!==200)c===404?(t(d("Người dùng không tồn tại!")),s.error("Người dùng không tồn tại!")):c===400?(t(d("Tên người dùng đã tồn tại. Vui lòng dùng tên khác.")),s.error("Tên người dùng đã tồn tại. Vui lòng dùng tên khác.")):(t(d("Có lỗi xảy ra trong quá trình!")),s.error("Có lỗi xảy ra trong quá trình!"));else{t(X(n)),s.success("Tài khoản đã cập nhật thành công!"),localStorage.setItem("token",n);var i=new Date().getTime();localStorage.setItem("setupTime",i.toString())}}catch(n){t(d("Có lỗi xảy ra trong quá trình!")),s.error("Có lỗi xảy ra trong quá trình!"),console.log(n.message)}};return a.jsxs("div",{className:"profile",children:[a.jsx(K,{}),a.jsxs("form",{onSubmit:q,className:"form",children:[a.jsx("input",{type:"file",ref:p,hidden:!0,accept:"image/*",onChange:e=>{e.target.files!==null&&T(e.target.files[0])}}),a.jsx("img",{src:u.imageUrl||r.image,alt:"",className:"profile-image",onClick:()=>{var e;p!=null&&((e=p.current)==null||e.click())}}),a.jsx("p",{className:"text-sm self-center",children:w?a.jsx("span",{className:"red",children:"Error uploading image (file size must be less than 2 MB)"}):g>0&&g<100?a.jsx("span",{className:"slate",children:`Uploading: ${g} %`}):g===100?a.jsx("span",{className:"green",children:"Image uploaded successfully"}):""}),a.jsx("input",{defaultValue:r.username,type:"text",id:"username",placeholder:"Username",className:"input-text",onChange:y,required:!0}),a.jsx("input",{defaultValue:r.email,type:"text",id:"email",placeholder:"Email",className:"input-text",disabled:!0}),a.jsx("input",{type:"password",id:"password",placeholder:"Change your password",className:"input-text",onChange:y}),a.jsx("button",{className:"slate btn-disable",children:k?"Loading...":"Update"})]}),a.jsxs("div",{className:"wrapper-function-btn",children:[a.jsx("span",{onClick:$,className:"red cursor-pointer",children:"Delete Account"}),a.jsx("span",{onClick:E,className:"blue cursor-pointer",children:"Sign out"})]})]})}export{Z as default};
